[{"id":"bee57c27.f464d","type":"tab","label":"Tellstick token","disabled":false,"info":""},{"id":"f54919c9.213138","type":"tab","label":"Flow 1","disabled":false,"info":""},{"id":"3f01cd35.030ec2","type":"http request","z":"bee57c27.f464d","name":"","method":"PUT","ret":"obj","paytoqs":false,"url":"http://192.168.1.5/api/token","tls":"","persist":false,"proxy":"","authType":"","x":490,"y":100,"wires":[["53f2a5d8.c4effc"]]},{"id":"80ff4668.1de698","type":"inject","z":"bee57c27.f464d","name":"","topic":"","payload":"app=\"Nodered\"","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":120,"y":100,"wires":[["792d3dec.20ec94"]]},{"id":"53f2a5d8.c4effc","type":"change","z":"bee57c27.f464d","name":"","rules":[{"t":"set","p":"requestToken","pt":"flow","to":"payload.token","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":680,"y":100,"wires":[["b2b833b6.ba298"]]},{"id":"fc16565e.3ba288","type":"http request","z":"bee57c27.f464d","name":"","method":"GET","ret":"obj","paytoqs":false,"url":"http://192.168.1.5/api/token?token={{{payload}}}","tls":"","persist":false,"proxy":"","authType":"","x":310,"y":220,"wires":[["132a117a.8a404f"]]},{"id":"132a117a.8a404f","type":"debug","z":"bee57c27.f464d","name":"access token","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload.token","x":470,"y":220,"wires":[]},{"id":"a9ae348d.7a5a28","type":"inject","z":"bee57c27.f464d","name":"","topic":"","payload":"requestToken","payloadType":"flow","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":130,"y":220,"wires":[["fc16565e.3ba288"]]},{"id":"a0a9a834.baf7a8","type":"comment","z":"bee57c27.f464d","name":"Step 2 - Authenticate the app","info":"Redirect the user to the url returned in step 1 to let him/her authenticate the app.","x":140,"y":140,"wires":[]},{"id":"9c433d2a.ed073","type":"comment","z":"bee57c27.f464d","name":"Step 1 - Request a request token","info":"Request a request token by performing a PUT call to the endpoint /api/token. You need to supply the application name as a parameter “app”\n  \n  http://api.telldus.net/localapi/api/authentication.html#step-1-request-a-request-token\n","x":150,"y":60,"wires":[]},{"id":"10a34a59.82ded6","type":"comment","z":"bee57c27.f464d","name":"Step 3 - Exchange the request token for an access token","info":"When the user has authenticated the request token in step 2 the application needs to exchange this for an access token. The access token can be used in the API requests. To exchange the request token for an access token perform a GET call to the same endpoint in step 1. Supply the request token as the parameter “token”.","x":230,"y":180,"wires":[]},{"id":"792d3dec.20ec94","type":"change","z":"bee57c27.f464d","name":"","rules":[{"t":"set","p":"headers","pt":"msg","to":"{\"content-type\":\"application/x-www-form-urlencoded\"}","tot":"json"}],"action":"","property":"","from":"","to":"","reg":false,"x":320,"y":100,"wires":[["3f01cd35.030ec2"]]},{"id":"b2b833b6.ba298","type":"debug","z":"bee57c27.f464d","name":"url","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload.authUrl","x":850,"y":100,"wires":[]},{"id":"79dc458f.a10a8c","type":"inject","z":"f54919c9.213138","name":"","topic":"","payload":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCIsImF1ZCI6IlwiTm9kZXJlZFwiIiwiZXhwIjoxNjA4MTU1OTQ5fQ.eyJyZW5ldyI6dHJ1ZSwidHRsIjozMTUzNjAwMH0.fcECO304jAiy5DkC3Xzvcvp7idfbyn4XqKWwxQLbSTs","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":130,"y":100,"wires":[[]]},{"id":"d58a4b44.ed1e68","type":"inject","z":"bee57c27.f464d","name":"","topic":"devices/list","payload":"{\"supportedMethods\":3}","payloadType":"json","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":140,"y":460,"wires":[["85901912.4f78c8"]]},{"id":"7c597390.403cdc","type":"debug","z":"bee57c27.f464d","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":690,"y":460,"wires":[]},{"id":"94dbf9c4.b3aab8","type":"inject","z":"bee57c27.f464d","name":"","topic":"refreshToken","payload":"accessToken","payloadType":"global","repeat":"86400","crontab":"","once":false,"onceDelay":0.1,"x":140,"y":340,"wires":[["1e779ce8.f820c3"]]},{"id":"6aadd871.8ead78","type":"http request","z":"bee57c27.f464d","name":"","method":"GET","ret":"obj","paytoqs":false,"url":"http://192.168.1.5/api/{{{topic}}}","tls":"","persist":false,"proxy":"","authType":"","x":510,"y":340,"wires":[["9b231eb3.dcbb8"]]},{"id":"1e779ce8.f820c3","type":"change","z":"bee57c27.f464d","name":"","rules":[{"t":"set","p":"headers","pt":"msg","to":"{\t   \"Authorization\":\"Bearer \" & payload\t}","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":340,"y":340,"wires":[["6aadd871.8ead78"]]},{"id":"a20b8da2.4f98","type":"debug","z":"bee57c27.f464d","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload.expires","targetType":"msg","x":940,"y":340,"wires":[]},{"id":"9b231eb3.dcbb8","type":"change","z":"bee57c27.f464d","name":"","rules":[{"t":"set","p":"accessToken","pt":"global","to":"payload.token","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":710,"y":340,"wires":[["a20b8da2.4f98"]]},{"id":"d476d7f4.31b578","type":"comment","z":"bee57c27.f464d","name":"Refresh token","info":"","x":90,"y":300,"wires":[]},{"id":"8af352e6.0b51b","type":"http request","z":"bee57c27.f464d","name":"","method":"GET","ret":"obj","paytoqs":true,"url":"http://192.168.1.5/api/{{{topic}}}","tls":"","persist":false,"proxy":"","authType":"","x":510,"y":460,"wires":[["7c597390.403cdc"]]},{"id":"85901912.4f78c8","type":"change","z":"bee57c27.f464d","name":"","rules":[{"t":"set","p":"headers","pt":"msg","to":"{\t   \"Authorization\":\"Bearer \" & $globalContext(\"accessToken\")\t}","tot":"jsonata"}],"action":"","property":"","from":"","to":"","reg":false,"x":340,"y":460,"wires":[["8af352e6.0b51b"]]},{"id":"20f52b7d.d1afa4","type":"comment","z":"bee57c27.f464d","name":"Example request","info":"","x":100,"y":420,"wires":[]}]